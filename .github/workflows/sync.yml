name: Sync Public Folder

on:
  schedule:
    - cron: '0 3 * * *'  # Every day at 3am UTC
  workflow_dispatch:

jobs:
  sync-folder:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Personal Repo
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Sparse Checkout
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"

          # Check if 'publicrepo' directory exists before creating it
          if [ ! -d "publicrepo" ]; then
            mkdir publicrepo
          fi
          cd publicrepo
          
          # Initialize Git and set remote
          git init
          git remote add origin https://github.com/vz-risk/VCDB.git

          # Enable sparse-checkout
          git sparse-checkout init --cone
          git sparse-checkout set data/json
          git pull origin master

          cd ..
          
          # Clean old copy of 'data/json' (optional)
          rm -rf data/json
          
          # Create the target directory if it doesn't exist
          mkdir -p data
          
          # Copy the 'data/json' directory from 'publicrepo' into the local 'data' folder
          cp -r publicrepo/data/json ./data/

      - name: Commit and Push Changes
        run: |
          git add .
          git commit -m "Auto-sync data/json from VCDB" || echo "No changes"
          git push
